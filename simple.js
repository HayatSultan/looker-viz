(()=>{"use strict";const t={id:"revenue_to_end_flow",label:"Revenue to End Flow",options:{revenue_dashboard_url:{type:"string",label:"Revenue Dashboard URL",default:"",section:"Dashboard Links"},gross_profit_dashboard_url:{type:"string",label:"Gross Profit Dashboard URL",default:"",section:"Dashboard Links"},operating_profit_dashboard_url:{type:"string",label:"Operating Profit Dashboard URL",default:"",section:"Dashboard Links"},operating_expenses_dashboard_url:{type:"string",label:"Operating Expenses Dashboard URL",default:"",section:"Dashboard Links"},cost_of_sales_dashboard_url:{type:"string",label:"Cost of Sales Dashboard URL",default:"",section:"Dashboard Links"},alliance_cost_dashboard_url:{type:"string",label:"Alliance Cost Dashboard URL",default:"",section:"Dashboard Links"},direct_sales_cost_dashboard_url:{type:"string",label:"Direct Sales Cost Dashboard URL",default:"",section:"Dashboard Links"},marketing_cost_dashboard_url:{type:"string",label:"Marketing Cost Dashboard URL",default:"",section:"Dashboard Links"},delivery_cost_dashboard_url:{type:"string",label:"Delivery Cost Dashboard URL",default:"",section:"Dashboard Links"},bench_cost_dashboard_url:{type:"string",label:"Bench Cost Dashboard URL",default:"",section:"Dashboard Links"},ebitda_dashboard_url:{type:"string",label:"EBITDA Dashboard URL",default:"",section:"Dashboard Links"},account_profitability_dashboard_url:{type:"string",label:"Account Profitability Dashboard URL",default:"",section:"Dashboard Links"},project_profitability_dashboard_url:{type:"string",label:"Project Profitability Dashboard URL",default:"",section:"Dashboard Links"},support_cost_dashboard_url:{type:"string",label:"Support Cost Dashboard URL",default:"",section:"Dashboard Links"},non_billable_cost_dashboard_url:{type:"string",label:"Non-Billable Cost Dashboard URL",default:"",section:"Dashboard Links"}},readyPromise:null,create:function(t,e){this.readyPromise=new Promise(e=>{const a=()=>{this.container=d3.select(t).append("div").attr("class","revenue-sankey-container").style("width","100%").style("height","100%").style("font-family","Arial, sans-serif").style("background-color","white").style("border-radius","8px").style("box-shadow","0 2px 10px rgba(0,0,0,0.1)").style("padding","20px"),e(null)};"undefined"!=typeof d3&&d3.sankey?a():this.loadD3().then(a)})},updateAsync:function(t,e,a,o,s,r){this.readyPromise.then(()=>{this.render(a,t,o),r()})},loadD3:function(){return new Promise(t=>{var e=document.createElement("script");e.src="https://d3js.org/d3.v7.min.js",e.onload=function(){var e=document.createElement("script");e.src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js",e.onload=function(){t(null)},document.head.appendChild(e)},document.head.appendChild(e)})},render:function(t,e,a){if(this.container.selectAll("*").remove(),e&&0!==e.length){var o=1200,s={top:40,right:40,bottom:40,left:40},r={Revenue:t.revenue_dashboard_url,"Gross Profit":t.gross_profit_dashboard_url,"Operating Profit":t.operating_profit_dashboard_url,"Operating Expenses":t.operating_expenses_dashboard_url,"Cost of Sales":t.cost_of_sales_dashboard_url,"Alliance Cost":t.alliance_cost_dashboard_url,"Direct Sales Cost":t.direct_sales_cost_dashboard_url,"Marketing Cost":t.marketing_cost_dashboard_url,"Delivery Cost":t.delivery_cost_dashboard_url,"Bench Cost":t.bench_cost_dashboard_url,EBITDA:t.ebitda_dashboard_url,"Account Profitability":t.account_profitability_dashboard_url,"Project Profitability":t.project_profitability_dashboard_url,"Support Cost":t.support_cost_dashboard_url,"Non-Billable Cost":t.non_billable_cost_dashboard_url},n=this.container.append("svg").attr("width",o).attr("height",600),i=d3.sankey().nodeWidth(20).nodePadding(30).extent([[s.left,s.top],[o-s.right,600-s.bottom]]),l=d3.scaleOrdinal(d3.schemeCategory10),d=i({nodes:[{name:"Revenue",id:"revenue"},{name:"Gross Profit",id:"gross_profit"},{name:"Operating Expenses",id:"operating_expenses"},{name:"Cost of Sales",id:"cost_of_sales"},{name:"Alliance Cost",id:"alliance_cost"},{name:"Direct Sales Cost",id:"direct_sales_cost"},{name:"Marketing Cost",id:"marketing_cost"},{name:"Delivery Cost",id:"delivery_cost"},{name:"Bench Cost",id:"bench_cost"},{name:"EBITDA",id:"ebitda"},{name:"Account Profitability",id:"account_profitability"},{name:"Project Profitability",id:"project_profitability"},{name:"Support Cost",id:"support_cost"},{name:"Non-Billable Cost",id:"non_billable_cost"}],links:[{source:0,target:1,value:200},{source:0,target:3,value:200},{source:1,target:2,value:100},{source:1,target:9,value:100},{source:2,target:4,value:20},{source:2,target:5,value:20},{source:2,target:6,value:20},{source:2,target:7,value:20},{source:2,target:8,value:20},{source:9,target:10,value:50},{source:9,target:11,value:50},{source:3,target:12,value:100},{source:3,target:13,value:100}]}),c=d.nodes,u=d.links;n.append("g").selectAll("path").data(u).join("path").attr("class","link").attr("d",d3.sankeyLinkHorizontal()).attr("stroke",function(t){return l(t.source.name)}).attr("stroke-width",function(t){return Math.max(1,t.width)}).attr("stroke-opacity",.5).attr("fill","none").style("transition","stroke-opacity 0.3s").on("mouseover",function(t,e){d3.select(this).attr("stroke-opacity",.7);var a=d3.select("body").append("div").attr("class","revenue-tooltip").style("position","absolute").style("background","rgba(0,0,0,0.8)").style("color","white").style("padding","8px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("opacity",0).style("z-index","1000");a.transition().duration(200).style("opacity",1),a.html(e.source.name+" → "+e.target.name+"<br/>Value: "+e.value.toLocaleString()).style("left",t.pageX+10+"px").style("top",t.pageY-28+"px")}).on("mouseout",function(t,e){d3.select(this).attr("stroke-opacity",.5),d3.selectAll(".revenue-tooltip").remove()});var p=n.append("g").selectAll("g").data(c).join("g").attr("class","node");p.append("rect").attr("x",function(t){return t.x0}).attr("y",function(t){return t.y0}).attr("height",function(t){return t.y1-t.y0}).attr("width",function(t){return t.x1-t.x0}).attr("fill",function(t){return l(t.name)}).attr("stroke","#333").attr("stroke-width",1).style("cursor","pointer").style("transition","all 0.3s ease").on("click",function(t,e){var a=r[e.name];a&&""!==a.trim()?window.open(a,"_blank"):alert("No dashboard URL configured for "+e.name+". Please configure it in the visualization settings.")}).on("mouseover",function(t,e){d3.select(this).style("filter","brightness(1.1)");var a=d3.select("body").append("div").attr("class","revenue-tooltip").style("position","absolute").style("background","rgba(0,0,0,0.9)").style("color","white").style("padding","10px").style("border-radius","5px").style("font-size","12px").style("pointer-events","none").style("opacity",0).style("z-index","1000").style("left",t.pageX+10+"px").style("top",t.pageY-28+"px"),o="<strong>"+e.name+"</strong><br/>Value: "+e.value.toLocaleString()+"<br/><em>Click to view dashboard</em><br/>";r[e.name]&&""!==r[e.name].trim()?o+="<small>→ Dashboard configured</small>":o+='<small style="color: #ffcccc;">No URL configured</small>',a.html(o),a.transition().duration(200).style("opacity",1)}).on("mouseout",function(t,e){d3.select(this).style("filter","brightness(1)"),d3.selectAll(".revenue-tooltip").remove()}),p.append("text").attr("x",function(t){return t.x0<600?t.x1+6:t.x0-6}).attr("y",function(t){return(t.y1+t.y0)/2}).attr("dy","0.35em").attr("text-anchor",function(t){return t.x0<600?"start":"end"}).text(function(t){return t.name}).style("font-size","12px").style("font-weight","bold").style("fill","#333").style("pointer-events","none")}else this.container.append("div").style("text-align","center").style("padding-top","40px").html("Run a query to see the Revenue Flow visualization.")}};looker.plugins.visualizations.add(t)})();
(()=>{"use strict";const e={id:"revenue_to_end_flow",label:"Revenue to End Flow",options:{account_performance_dashboard_url:{type:"string",label:"Account Performance Dashboard URL",default:"https://dev.internal.looker.datatonic.team/dashboards/459",section:"Dashboard Links"},sales_performance_dashboard_url:{type:"string",label:"Sales Performance Dashboard URL",default:"https://dev.internal.looker.datatonic.team/dashboards/459",section:"Dashboard Links"},marketing_performance_dashboard_url:{type:"string",label:"Marketing Performance Dashboard URL",default:"",section:"Dashboard Links"},pipeline_dashboard_url:{type:"string",label:"Pipeline Dashboard URL",default:"",section:"Dashboard Links"},backlog_dashboard_url:{type:"string",label:"Backlog Dashboard URL",default:"",section:"Dashboard Links"},revenue_dashboard_url:{type:"string",label:"Revenue Dashboard URL",default:"",section:"Dashboard Links"},gross_profit_dashboard_url:{type:"string",label:"Gross Profit Dashboard URL",default:"",section:"Dashboard Links"},operating_expenses_dashboard_url:{type:"string",label:"Operating Expenses Dashboard URL",default:"",section:"Dashboard Links"},support_cost_dashboard_url:{type:"string",label:"Support Cost Dashboard URL",default:"",section:"Dashboard Links"},non_billable_cost_dashboard_url:{type:"string",label:"Non-Billable Cost Dashboard URL",default:"",section:"Dashboard Links"},ebitda_dashboard_url:{type:"string",label:"EBITDA Dashboard URL",default:"",section:"Dashboard Links"},account_profitability_dashboard_url:{type:"string",label:"Account Profitability Dashboard URL",default:"",section:"Dashboard Links"},project_profitability_dashboard_url:{type:"string",label:"Project Profitability Dashboard URL",default:"",section:"Dashboard Links"},cost_of_sales_dashboard_url:{type:"string",label:"Cost of Sales Dashboard URL",default:"",section:"Dashboard Links"},alliance_cost_dashboard_url:{type:"string",label:"Alliance Cost Dashboard URL",default:"",section:"Dashboard Links"},direct_sales_cost_dashboard_url:{type:"string",label:"Direct Sales Cost Dashboard URL",default:"",section:"Dashboard Links"},marketing_cost_dashboard_url:{type:"string",label:"Marketing Cost Dashboard URL",default:"",section:"Dashboard Links"},delivery_cost_dashboard_url:{type:"string",label:"Delivery Cost Dashboard URL",default:"",section:"Dashboard Links"},bench_cost_dashboard_url:{type:"string",label:"Bench Cost Dashboard URL",default:"",section:"Dashboard Links"}},readyPromise:null,create:function(e,t){this.readyPromise=new Promise(t=>{const a=()=>{this.container=d3.select(e).append("div").attr("class","revenue-sankey-container").style("width","100%").style("height","100%").style("font-family","Arial, sans-serif"),t(null)};"undefined"!=typeof d3&&d3.sankey?a():this.loadD3().then(a)})},updateAsync:function(e,t,a,r,o,s){this.readyPromise.then(()=>{this.render(a,e,r),s()})},loadD3:function(){return new Promise(e=>{var t=document.createElement("script");t.src="https://d3js.org/d3.v7.min.js",t.onload=function(){var t=document.createElement("script");t.src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js",t.onload=function(){e(null)},document.head.appendChild(t)},document.head.appendChild(t)})},render:function(e,t,a){if(this.container.selectAll("*").remove(),t&&0!==t.length){var r=1800,o=10,s=10,n=10,i=10,l={"Account Performance":e.account_performance_dashboard_url,"Sales Performance":e.sales_performance_dashboard_url,"Marketing Performance":e.marketing_performance_dashboard_url,Pipeline:e.pipeline_dashboard_url,Backlog:e.backlog_dashboard_url,REVENUE:e.revenue_dashboard_url,"Gross Profit":e.gross_profit_dashboard_url,EXPENSES:e.operating_expenses_dashboard_url,"Support Cost":e.support_cost_dashboard_url,"Non-Billable Cost":e.non_billable_cost_dashboard_url,EBITDA:e.ebitda_dashboard_url,"Account Profitability":e.account_profitability_dashboard_url,"Project Profitability":e.project_profitability_dashboard_url,"COST OF SALES":e.cost_of_sales_dashboard_url,"Alliance Cost":e.alliance_cost_dashboard_url,"Direct Sales Cost":e.direct_sales_cost_dashboard_url,"Marketing Cost":e.marketing_cost_dashboard_url,"Delivery Cost":e.delivery_cost_dashboard_url,"Bench Cost":e.bench_cost_dashboard_url},d=this.container.append("svg").attr("width",r).attr("height",700),c=d3.sankey().nodeWidth(30).nodePadding(65).nodeSort(null).extent([[i,o],[r-s,700-n]]),u=d3.scaleOrdinal(d3.schemeCategory10),_=c({nodes:[{name:"Account Performance",id:"account_performance"},{name:"Sales Performance",id:"sales_performance"},{name:"Marketing Performance",id:"marketing_performance"},{name:"Pipeline",id:"pipeline"},{name:"Backlog",id:"backlog"},{name:"",id:"rest_of_pipeline"},{name:"REVENUE",id:"revenue"},{name:"Gross Profit",id:"gross_profit"},{name:"EXPENSES",id:"operating_expenses"},{name:"Support Cost",id:"support_cost"},{name:"Non-Billable Cost",id:"non_billable_cost"},{name:"EBITDA",id:"ebitda"},{name:"Account Profitability",id:"account_profitability"},{name:"Project Profitability",id:"project_profitability"},{name:"COST OF SALES",id:"cost_of_sales"},{name:"Alliance Cost",id:"alliance_cost"},{name:"Direct Sales Cost",id:"direct_sales_cost"},{name:"Marketing Cost",id:"marketing_cost"},{name:"Delivery Cost",id:"delivery_cost"},{name:"Bench Cost",id:"bench_cost"},{name:"EarlyEnd",id:"early_end"},{name:"",id:"dummy_node1"},{name:"",id:"dummy_node2"}],links:[{source:0,target:3,value:70},{source:1,target:3,value:70},{source:2,target:3,value:70},{source:3,target:4,value:210},{source:4,target:6,value:210},{source:6,target:7,value:120},{source:6,target:14,value:90},{source:7,target:8,value:90},{source:7,target:21,value:0},{source:7,target:11,value:30},{source:21,target:22,value:0},{source:22,target:11,value:0},{source:8,target:9,value:45},{source:8,target:10,value:45},{source:9,target:20,value:20},{source:10,target:20,value:20},{source:11,target:12,value:15},{source:11,target:13,value:15},{source:14,target:21,value:1},{source:21,target:15,value:1},{source:14,target:15,value:18},{source:21,target:16,value:1},{source:14,target:16,value:18},{source:21,target:17,value:1},{source:14,target:17,value:18},{source:21,target:18,value:1},{source:14,target:18,value:18},{source:21,target:19,value:1},{source:14,target:19,value:18},{source:15,target:20,value:18},{source:16,target:20,value:18},{source:17,target:20,value:18},{source:18,target:20,value:18},{source:19,target:20,value:18}]}),b=_.nodes,p=_.links;d.append("g").selectAll("path").data(p.filter(e=>{const t="gross_profit"===e.source.id&&"dummy_node1"===e.target.id,a="direct_sales_cost"===e.source.id&&"early_end"===e.target.id,r="marketing_cost"===e.source.id&&"early_end"===e.target.id,o="delivery_cost"===e.source.id&&"early_end"===e.target.id,s="bench_cost"===e.source.id&&"early_end"===e.target.id,n="alliance_cost"===e.source.id&&"early_end"===e.target.id,i="support_cost"===e.source.id&&"early_end"===e.target.id,l="non_billable_cost"===e.source.id&&"early_end"===e.target.id,d="cost_of_sales"===e.source.id&&"dummy_node1"===e.target.id,c="dummy_node1"===e.source.id&&"alliance_cost"===e.target.id,u="dummy_node1"===e.source.id&&"direct_sales_cost"===e.target.id,_="dummy_node1"===e.source.id&&"marketing_cost"===e.target.id,b="dummy_node1"===e.source.id&&"delivery_cost"===e.target.id,p="dummy_node1"===e.source.id&&"bench_cost"===e.target.id,h="dummy_node1"===e.source.id&&"dummy_node2"===e.target.id,g="dummy_node2"===e.source.id&&"ebitda"===e.target.id;return!(t||a||r||o||s||n||i||l||d||c||u||_||b||p||h||g)})).join("path").attr("class","link").attr("d",d3.sankeyLinkHorizontal()).attr("stroke",function(e){return u(e.source.name)}).attr("stroke-width",function(e){return Math.max(1,e.width)}).attr("stroke-opacity",.5).attr("fill","none").style("transition","stroke-opacity 0.3s").on("mouseover",function(e,t){d3.select(this).attr("stroke-opacity",.7);var a=d3.select("body").append("div").attr("class","revenue-tooltip").style("position","absolute").style("background","rgba(0,0,0,0.8)").style("color","white").style("padding","8px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("opacity",0).style("z-index","1000");a.transition().duration(200).style("opacity",1),a.html(t.source.name+" â†’ "+t.target.name+"<br/>Value: "+t.value.toLocaleString()).style("left",e.pageX+10+"px").style("top",e.pageY-28+"px")}).on("mouseout",function(e,t){d3.select(this).attr("stroke-opacity",.5),d3.selectAll(".revenue-tooltip").remove()});var h=d.append("g").selectAll("g").data(b.filter(e=>"EarlyEnd"!==e.name&&""!==e.name)).join("g").attr("class","node");h.append("rect").attr("x",function(e){return e.x0}).attr("y",function(e){return e.y0}).attr("height",function(e){return e.y1-e.y0}).attr("width",function(e){return e.x1-e.x0}).attr("fill",function(e){return u(e.name)}).attr("stroke","#333").attr("stroke-width",1).style("cursor","pointer").style("transition","all 0.3s ease").on("click",function(e,t){var a=l[t.name];a&&""!==a.trim()?window.open(a,"_blank"):alert("No dashboard URL configured for "+t.name+". Please configure it in the visualization settings.")}).on("mouseover",function(e,t){d3.select(this).style("filter","brightness(1.1)");var a=d3.select("body").append("div").attr("class","revenue-tooltip").style("position","absolute").style("background","rgba(0,0,0,0.9)").style("color","white").style("padding","10px").style("border-radius","5px").style("font-size","12px").style("pointer-events","none").style("opacity",0).style("z-index","1000").style("left",e.pageX+10+"px").style("top",e.pageY-28+"px"),r="<strong>"+t.name+"<br/><em>Click to view dashboard</em><br/>";l[t.name]&&""!==l[t.name].trim()?r+="":r+='<small style="color: #ffcccc;">No URL configured</small>',a.html(r),a.transition().duration(200).style("opacity",1)}).on("mouseout",function(e,t){d3.select(this).style("filter","brightness(1)"),d3.selectAll(".revenue-tooltip").remove()}),h.append("text").attr("x",function(e){return e.x0<900?e.x1+6:e.x0-6}).attr("y",function(e){return(e.y1+e.y0)/2}).attr("dy","0.35em").attr("text-anchor",function(e){return e.x0<900?"start":"end"}).text(function(e){return e.name}).style("font-size","12px").style("font-weight","bold").style("fill","#333").style("pointer-events","none")}else this.container.append("div").style("text-align","center").style("padding-top","40px").html("Run a query to see the Revenue Flow visualization.")}};looker.plugins.visualizations.add(e)})();